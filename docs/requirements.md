# Mu 要件定義書（全文） v1.0

## 0. 基本情報

* **プロダクト名**：Mu（「無」をモチーフに、機能を絞って軽量化）
* **対象**：一般公開（パブリック配布）
* **優先プラットフォーム**：デスクトップ（Windows / macOS / Linux）
* **技術方針（確定）**：Tauri + Solid + Tailwind CSS + SolidUI（UI部品は取り込み運用）

---

## 1. 背景と目的

### 1.1 背景

既存ブラウザは機能・統合が増え続け、UI/常駐機能/拡張の影響で「軽い」体験を得にくい。Muは、機能の取捨選択により**起動・メモリ・配布サイズ**のコストを抑え、必要最低限のブラウジングに集中する。

### 1.2 目的

* **軽量**（起動・メモリ・配布サイズ）を最優先したミニマルブラウザを提供する
* UIを「必要な操作だけ」に制限し、学習コストと認知負荷を下げる
* OS標準WebViewを活用し、同梱ランタイムを避けてアプリを小さく保つ

### 1.3 成功条件（KPI/受け入れ基準の根拠）

* **コールド起動 2秒以内**
* **メモリ**：空タブ 200MB 以下 / タブ10枚 600MB 以下
* **配布物サイズ**：20MB 以下（※後述の定義に従う）

---

## 2. スコープ

### 2.1 MVPで提供する（In Scope）

* 縦タブ（単純リスト）
* サイドバー（縦タブ + 戻る/進む/リロード）
* Ctrl+T のURL/検索入力モーダル（履歴/ブックマークのサジェスト）
* セッション復元（前回のタブ復元）
* 履歴（保持90日、手動削除可能）
* Cookie許可（詳細設定は将来）
* ダウンロード（保存先選択、進捗、再試行、一時停止/再開）
* HTTP警告（戻る/続行）
* ライト/ダークテーマ
* 閲覧データ削除（履歴+Cookie+キャッシュ+サイトデータをまとめて削除）
* テレメトリ（Opt-in、デフォルトOFF、匿名）
* 匿名クラッシュレポート（Opt-in連動推奨）

### 2.2 MVPでは提供しない（Out of Scope / Non-Goals）

* 拡張機能
* 複数プロファイル
* 内蔵広告ブロック（将来検討）
* Chrome拡張互換
* 企業ポリシー管理（将来の余裕があれば）
* DRMストリーミングの再生保証（後述）

---

## 3. 対象ユーザー・利用環境

### 3.1 想定ユーザー

* 一般ユーザー（特定組織や学内PCなどの制約は想定しない）

### 3.2 対象プラットフォーム

* Windows / macOS / Linux（デスクトップ優先）
* モバイルは将来の検討対象

### 3.3 性能受け入れの基準環境（固定）

* OS：Windows 11
* CPU：Core i5 世代
* RAM：16GB

> MVPの性能（起動/メモリ）のPass/Fail判定は上記環境で実施する。macOS/Linuxは機能対応の範囲で最適化を継続する（ベストエフォート）。

---

## 4. 用語定義

* **UI WebView**：MuのUI（縦タブ、サイドバー、設定画面等）を表示するWebView
* **コンテンツWebView**：タブごとに外部サイトを表示するWebView
* **セッション復元**：起動時に前回終了時のタブURL群を復元する機能
* **閲覧データ**：履歴、Cookie、キャッシュ、サイトデータ（localStorage等）を含むローカルデータ

---

## 5. アーキテクチャ要件（技術・セキュリティ前提）

### 5.1 技術スタック（確定）

* Tauri（アプリ基盤）
* Rust（バックエンド/権限・ネイティブ連携）
* Solid + TypeScript（UI）
* Tailwind CSS（スタイル）
* SolidUI（UIコンポーネントを取り込み運用）
* Bun（開発ツール/パッケージ管理）

### 5.2 WebView構成（必須要件）

* 1つのアプリウィンドウ内に：

  * UI WebView（ローカルUI）
  * 複数のコンテンツWebView（タブ）
* タブ切替は「表示対象のコンテンツWebView」を切り替える（表示/非表示、もしくはレイアウト移動）

### 5.3 権限分離（必須・最重要）

* **UI WebViewのみ**がアプリ権限（ファイル、DB、設定、テレメトリ送信等）を持つ
* **コンテンツWebViewは権限ゼロ**（Tauri APIにアクセスできない）

  * 外部サイト（任意URL）を読み込むため、権限漏えいを根本的に遮断する

### 5.4 DRMの扱い（仕様）

* DRMストリーミング（例：一部の有料配信）について **動作を保証しない**
* 再生不可の場合の救済として：

  * **「既定ブラウザで開く」導線**を提供（推奨要件）

---

## 6. 機能要件（Functional Requirements）

以下、必須（Must）を中心に定義する。

### 6.1 タブ機能（Must）

* タブを複数保持できる
* 縦タブによりタブ一覧を表示できる（**単純リスト**）
* タブを切り替えられる

**非対応（MVP）**

* タブツリー、タブグループ、自動整理、固定タブ等は対象外

### 6.2 サイドバー（Must）

サイドバーは常時表示し、以下を含む。

* 縦タブ領域
* ナビゲーションボタン：

  * 戻る / 進む / リロード

### 6.3 URL/検索入力（Ctrl+Tモーダル）（Must）

* **Ctrl+T**で中央モーダルを開く
* 入力はURLまたは検索語を受け付ける
* Enterで遷移
* サジェストは **履歴およびブックマーク** から提示する

**推奨ショートカット（Should）**

* Ctrl+L / Ctrl+K：モーダルを開く（既存ブラウザ互換）

**検索エンジン**

* MVP：Google固定
* 将来：選択可能にする（設定化）

### 6.4 ブックマーク（Must：最小）

サジェスト要件を成立させるため、最低限のブックマーク機能を持つ。

* 現在ページをブックマーク登録できる
* ブックマークを削除できる
* ブックマークはCtrl+Tモーダルの候補に出る

> ブックマーク管理UI（一覧画面/タグ/フォルダ等）はMVPでは必須にしない（将来拡張）。

### 6.5 履歴（Must）

* 履歴を記録する（URL、タイトル、時刻）
* 保持期間：**90日**
* 90日を超えた履歴は自動削除する
* 手動削除（全削除、および期間指定削除）を提供する（後述の「閲覧データ削除」と別でも可）

### 6.6 セッション復元（Must）

* アプリ起動時に前回のタブを復元する
* 復元対象（MVP最小）：

  * タブのURL一覧
  * 最後にアクティブだったタブ

**失敗時挙動**

* 復元できない場合は空セッションで起動し、通知は最小限

### 6.7 Cookie/サイトデータ（Must：最小）

* Cookieはデフォルト許可
* サイト権限・Cookie例外などの詳細設定は将来

### 6.8 ダウンロード（Must）

* ダウンロード開始時に保存先を選択できる
* 進捗を表示できる
* 一時停止/再開ができる
* 失敗時に再試行できる
* ダウンロード履歴を保持する（将来、削除/期間指定を設定化）

### 6.9 HTTP警告（Must）

* http（非TLS）ページへ遷移しようとした場合、警告を表示する（インタースティシャル）
* 選択肢：

  * **戻る**
  * **続行（今回のみ）**
* 恒久許可（例外ルール）はMVPでは提供しない

### 6.10 テーマ（Must）

* ライト/ダークの2種

### 6.11 閲覧データ削除（Must）

「履歴+Cookie+キャッシュ等」をまとめて削除できる。

**MVPで削除対象に含める（必須）**

* 履歴
* Cookie
* キャッシュ（HTTPキャッシュ相当）
* サイトデータ

  * localStorage / sessionStorage
  * IndexedDB
  * Service Worker / Cache Storage

**削除後の期待挙動（受け入れ条件）**

* 主要サイトはログアウト状態になる（Cookie削除の結果）
* 推奨：削除実行時に「セッション復元情報も削除」し、次回は空セッション起動

**将来要件**

* ユーザーが削除対象を選択できる（チェックボックス方式）

---

## 7. 非機能要件（Non-Functional Requirements）

### 7.1 性能要件（受け入れ基準）

基準環境（Windows 11 / Core i5 / RAM16GB）にて：

* **コールド起動：2秒以内**
* **メモリ**：

  * 空タブ：200MB 以下
  * タブ10枚：600MB 以下

### 7.2 ベンチマーク定義（タブ10枚）

同時に以下の10サイトを開いた状態で測定する：

* google / youtube / wikipedia / github / gmail / chatgpt / gemini / reddit / note / x

**測定条件（ブレ防止）**

* 基本はログアウト状態（個人環境依存を排除）
* 起動→セッション復元→30秒待機後に計測（ロード後アイドル化を待つ）

### 7.3 配布物サイズ要件（20MB以下の定義）

「20MB以下」の評価対象を以下に定義する。

* Windows：初回ダウンロード対象（インストーラ/ブートストラップ）を20MB以下
* macOS：配布dmg（またはzip）を20MB以下
* Linux：主配布形式をパッケージ（例：.deb/.rpm）とし、20MB要件は「主配布物」に適用

  * 単一ファイル配布（AppImage等）をMVPの主配布にしない（サイズ要件と相性が悪いため）

### 7.4 更新方式（Must）

* 手動更新（自動更新は提供しない）

### 7.5 信頼性・可用性（Must）

* ブラウジング中にクラッシュしないことを最優先
* クラッシュ時、次回起動が阻害されない（復元失敗時は空セッション）

---

## 8. プライバシー・セキュリティ要件

### 8.1 テレメトリ（Must）

* Opt-in（ユーザーが明示的にONにした場合のみ送信）
* デフォルトOFF
* 収集内容：

  * パフォーマンス統計（起動時間、メモリ概算、主要操作の時間など）
  * 機能利用頻度（機能の使用回数、集計データ）
* 個人を直接特定するデータ（個別URL、入力内容、Cookie内容等）は原則送信しない（集計設計）

### 8.2 クラッシュレポート（Must）

* 匿名
* 推奨：テレメトリ設定に連動してOpt-in（同意設計を単純化）

### 8.3 パスワード管理（Must：方針）

* OSキーチェーンを利用（Windows Credential Manager / macOS Keychain等）
* MVP段階の推奨：

  * 保存機能は提供してよい
  * 自動入力は段階導入（安全設計が固まってから）

### 8.4 権限・サンドボックス（Must）

* 外部サイトを描画するコンテンツWebViewはTauri権限ゼロ
* UI WebViewのみが権限を持つ（設定/DB/送信等）
* “既定ブラウザで開く” は安全な脱出口として提供（推奨）

---

## 9. UI/UX要件

### 9.1 UI原則

* 常時UIは最小（サイドバーのみ、アドレスバー常設しない）
* 主要操作はキーボード中心（Ctrl+Tを中心に設計）

### 9.2 ショートカット（Must/Should）

* Must：

  * Ctrl+T：入力モーダル
  * Esc：モーダルを閉じる
* Should（互換性・利便性）：

  * Ctrl+L / Ctrl+K：入力モーダル
  * Ctrl+W：タブを閉じる
  * Ctrl+Tab / Ctrl+Shift+Tab：タブ移動

### 9.3 新規タブ体験（MVP）

* Ctrl+T → 入力 → Enter を基本導線とする
* “新規タブページ”は必須にしない（空白でも可）

---

## 10. データ要件（保存・削除・保持）

### 10.1 保存対象（MVP）

* 履歴（90日）
* ダウンロード履歴
* セッション復元情報
* 設定
* ブックマーク

### 10.2 保存場所（推奨・要件）

* OS標準のユーザーデータ領域（ユーザー単位）
* 形式：

  * 履歴/復元/DL履歴：SQLite推奨
  * 設定：JSONまたはSQLite

### 10.3 削除

* 「閲覧データ削除」で必須セットをまとめて削除（6.11参照）

---

## 11. テスト要件（Acceptance Test / QA）

### 11.1 受け入れ試験（最低限）

* 性能（基準環境）：

  * コールド起動 2秒以内
  * 空タブ 200MB以下
  * 10タブ 600MB以下（ベンチ定義に従う）
* 機能：

  * Ctrl+TモーダルでURL/検索が可能
  * 縦タブで切替できる
  * 戻る/進む/リロードが機能する
  * セッション復元が機能する
  * 履歴が保存され、90日超で自動削除される（疑似で日付操作または期間短縮テスト）
  * ダウンロード（保存先/進捗/一時停止/再試行）が機能する
  * HTTP警告が出る（戻る/続行）
  * 閲覧データ削除後にログアウト状態になる等が確認できる
  * テレメトリはデフォルトOFF、ONで送信が行われる（送信内容は集計のみ）

### 11.2 互換性（ベストエフォート）

* Windows以外は主要機能が動作すること（性能は参考値）
* LinuxはWayland/X11両方を想定し、Tier1（例：Ubuntu LTS）での動作確認を優先

---

## 12. リリース・運用要件

* 手動更新
* リリースはStable単一から開始（Beta分岐は将来）
* 不具合報告導線（Issue/フォーム等）は整備（MVP後半で可）

---

## 13. リスクと制約

* OS標準WebView依存のため、OS・ディストリ差で挙動が変動する（特にLinux）
* DRMは保証しない（サイト側の要件・WebView制約に左右される）
* 配布サイズ20MBはLinux配布形式を誤ると達成困難（主配布をパッケージ化する）

---

## 14. 将来拡張（ロードマップ候補）

* 検索エンジン選択
* Cookie/サイト権限制御（例外設定）
* 閲覧データ削除の選択UI（カテゴリ別チェック）
* 広告ブロック（任意）
* 企業/学校向けポリシー（余裕があれば）
* モバイル対応（余裕があれば）

---

## 15. 付録：MVP要件一覧（Must/Should/Won’t）

### Must

* 縦タブ（単純リスト）
* サイドバー（縦タブ + 戻る/進む/リロード）
* Ctrl+T入力モーダル（履歴/ブックマークサジェスト）
* セッション復元
* 履歴（90日、手動削除）
* Cookie許可
* ダウンロード（保存先/進捗/一時停止/再試行）
* HTTP警告（戻る/続行）
* ライト/ダーク
* 閲覧データ削除（履歴+Cookie+キャッシュ+サイトデータ）
* テレメトリ：Opt-in（デフォルトOFF、匿名）
* クラッシュレポート（匿名、Opt-in連動推奨）
* 権限分離（UI WebViewのみ権限、コンテンツWebViewは権限ゼロ）
* 手動更新

### Should

* Ctrl+L / Ctrl+Kで入力モーダル
* Ctrl+W、Ctrl+Tab 系ショートカット
* 既定ブラウザで開く導線（DRM/相性問題の回避）

### Won’t（MVP）

* 拡張機能、プロファイル、Chrome拡張互換、広告ブロック（後回し）

---

もし次に進めるなら、この要件定義から **「画面仕様（ワイヤー相当）」** と **「データ設計（SQLiteスキーマ案）」** を起こすのが最短です。どちらから書きますか（UI仕様 → DB設計の順が一般に手戻りが少ないです）。
